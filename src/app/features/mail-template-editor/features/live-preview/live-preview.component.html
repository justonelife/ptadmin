@let _preview = preview();
<div class="flex justify-between items-center w-full mb-4">
  <div>
    Preview
    <br />
    <span class="text-sm fg-secondary">Live preview</span>
  </div>

  <div class="min-h-10 flex gap-1 flex-wrap items-center">
    <button
      type="button"
      lib-button
      icon="download"
      iconSet="outlined-sm"
      appearance="ghost"
      severity="neutral"
    >
      All Languages
    </button>
    <button
      lib-button
      icon="wand_stars"
      iconSet="outlined"
      (click)="generatePreviewAllLanguages()"
    >
      Generate for All Languages
    </button>
  </div>
</div>

<div class="grid grid-cols-2 gap-2">
  <lib-card withToggle>
    <ng-template #title>
      <span class="font-medium text-base inline-flex gap-1 items-center">
        <span
          libIconPosition="center left"
          icon="data_object"
          iconSet="outlined"
        ></span>
        <span class="fg-primary">Variables</span>
      </span>
    </ng-template>

    <div
      class="flex gap-1 flex-wrap items-center mt-2 max-h-[357px] overflow-y-auto"
    >
      @for (variable of store.variables() | keyvalue; track variable.key) {
        <button lib-button class="p-1 h-6 break-all" severity="neutral">
          {{ variable.key }}
        </button>
      }
    </div>
  </lib-card>

  <div class="flex flex-col gap-2">
    <lib-text-input
      type="textarea"
      [ngModel]="mailTemplate"
      [rows]="20"
      (ngModelChange)="store.updateMailTemplate($event)"
    ></lib-text-input>
  </div>
</div>

<lib-card class="block mt-4">
  <div class="flex flex-col gap-2">
    <div class="flex gap-4 justify-between">
      <div class="flex items-center gap-2">
        <lib-select
          [options]="languageOptions()"
          [(ngModel)]="selectedLanguage"
        ></lib-select>

        <button
          type="button"
          lib-button
          icon="desktop_windows"
          iconSet="outlined"
        >
          Desktop
        </button>
        <button
          type="button"
          lib-button
          icon="mobile"
          iconSet="outlined"
          severity="neutral"
        >
          Mobile
        </button>
      </div>

      <div class="flex items-end">
        <button
          type="button"
          lib-button
          icon="content_copy"
          iconSet="outlined-sm"
          appearance="ghost"
          severity="neutral"
          [cdkCopyToClipboard]="_preview[selectedLanguage] | htmlMinify"
          (cdkCopyToClipboardCopied)="previewCopied()"
        >
          Copy
        </button>

        <button
          type="button"
          lib-button
          icon="download"
          iconSet="outlined-sm"
          appearance="ghost"
          severity="neutral"
        >
          Download
        </button>
      </div>
    </div>

    <lib-tabs [tabs]="TABS" perserveContent>
      <ng-template libTemplate="live-preview">
        <div class="flex flex-col gap-2 w-full h-[500px] mt-4">
          <!-- <div class="flex gap-2"> -->
          <!--   <button type="button" lib-button icon="desktop_windows" iconSet="outlined"> -->
          <!--     Desktop -->
          <!--   </button> -->
          <!--   <button type="button" lib-button icon="mobile" iconSet="outlined" severity="neutral"> -->
          <!--     Mobile -->
          <!--   </button> -->
          <!---->
          <!-- </div> -->

          <iframe
            class="w-full h-full"
            [srcdoc]="_preview[selectedLanguage] | safeHtml"
          ></iframe>
        </div>
      </ng-template>
      <ng-template libTemplate="code-preview">
        <div
          class="overflow-auto rounded-lg bg-gray-900 p-4 text-sm leading-relaxed mt-4 h-[500px] overflow-y-auto"
        >
          <code
            class="text-gray-300 flex flex-wrap"
            [innerHTML]="
              _preview[selectedLanguage] | htmlMinify | htmlSyntaxHighlight
            "
          ></code>
        </div>
      </ng-template>
    </lib-tabs>
  </div>
</lib-card>
